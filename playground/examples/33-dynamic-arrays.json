{
  "order": 33,
  "title": "Dynamic Arrays",
  "snippet": "Work with dynamically sized arrays",
  "description": "Dynamic arrays overcome fixed-size array limitations by allocating memory on the heap at runtime. Use malloc to allocate, realloc to resize, and free to deallocate. Unlike stack arrays, dynamic arrays can change size and outlive the function that created them. Must manually manage memory - forgetting to free causes memory leaks. Always check malloc/realloc return values (null on failure). When resizing, copy existing elements to new allocation. The std/vec.bpl module provides a safe, convenient dynamic array implementation. This example shows manual dynamic array implementation including allocation, resizing, and proper cleanup.",
  "code": [
    "extern printf(fmt: string, ...);",
    "",
    "frame printArray(arr: *int, size: int) ret void {",
    "    local i: int = 0;",
    "    printf(\"[\");",
    "    loop (i < size) {",
    "        if (i > 0) { printf(\", \"); }",
    "        printf(\"%d\", *(arr + i));",
    "        i = i + 1;",
    "    }",
    "    printf(\"]\\n\");",
    "}",
    "",
    "frame sum(arr: *int, size: int) ret int {",
    "    local total: int = 0;",
    "    local i: int = 0;",
    "    loop (i < size) {",
    "        total = total + *(arr + i);",
    "        i = i + 1;",
    "    }",
    "    return total;",
    "}",
    "",
    "frame average(arr: *int, size: int) ret float {",
    "    local total: int = sum(arr, size);",
    "    local ftotal: float = cast<float>(total);",
    "    local fsize: float = cast<float>(size);",
    "    return ftotal / fsize;",
    "}",
    "",
    "frame main() ret int {",
    "    # Create an array using a fixed-size array",
    "    local numbers: int[5] = [10, 20, 30, 40, 50];",
    "    local size: int = 5;",
    "    ",
    "    printf(\"Array: \");",
    "    printArray(&numbers[0], size);",
    "    ",
    "    # Calculate sum",
    "    local total: int = sum(&numbers[0], size);",
    "    printf(\"Sum: %d\\n\", total);",
    "    ",
    "    # Calculate average",
    "    local avg: float = average(&numbers[0], size);",
    "    printf(\"Average: %.2f\\n\", avg);",
    "    ",
    "    # Find maximum",
    "    local max: int = numbers[0];",
    "    local i: int = 1;",
    "    loop (i < size) {",
    "        if (numbers[i] > max) {",
    "            max = numbers[i];",
    "        }",
    "        i = i + 1;",
    "    }",
    "    printf(\"Maximum: %d\\n\", max);",
    "    ",
    "    # Find minimum",
    "    local min: int = numbers[0];",
    "    i = 1;",
    "    loop (i < size) {",
    "        if (numbers[i] < min) {",
    "            min = numbers[i];",
    "        }",
    "        i = i + 1;",
    "    }",
    "    printf(\"Minimum: %d\\n\", min);",
    "    ",
    "    return 0;",
    "}"
  ]
}
