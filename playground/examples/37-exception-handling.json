{
  "order": 37,
  "title": "Exception Handling",
  "snippet": "Try-catch-throw exception handling",
  "description": "BPL supports structured exception handling with try, catch, and throw. You can throw any type (structs, primitives). catch blocks match by type. If no catch matches, the exception propagates up the call stack. A catchOther block can catch any exception type not previously matched. This provides a robust mechanism for handling runtime errors without cluttering code with return code checks.",
  "code": [
    "extern printf(fmt: string, ...);",
    "",
    "# Define error types",
    "struct DivisionByZeroError {",
    "    message: string,",
    "}",
    "",
    "struct OutOfBoundsError {",
    "    index: int,",
    "    size: int,",
    "}",
    "",
    "# Function that throws an exception",
    "frame safeDivide(a: int, b: int) ret int {",
    "    if (b == 0) {",
    "        local err: DivisionByZeroError;",
    "        err.message = \"Cannot divide by zero\";",
    "        throw err;",
    "    }",
    "    return a / b;",
    "}",
    "",
    "# Function that throws a different exception",
    "frame safeArrayAccess(arr: *int, size: int, index: int) ret int {",
    "    if (index < 0 || index >= size) {",
    "        local err: OutOfBoundsError;",
    "        err.index = index;",
    "        err.size = size;",
    "        throw err;",
    "    }",
    "    return *(arr + index);",
    "}",
    "",
    "frame main() ret int {",
    "    printf(\"=== Exception Handling Example ===\\n\\n\");",
    "    ",
    "    # Example 1: Try-Catch with Division",
    "    printf(\"Safe Division:\\n\");",
    "    try {",
    "        local result: int = safeDivide(10, 2);",
    "        printf(\"10 / 2 = %d\\n\", result);",
    "        ",
    "        # This will throw",
    "        printf(\"Attempting 10 / 0...\\n\");",
    "        safeDivide(10, 0);",
    "        printf(\"This line should not be reached\\n\");",
    "    } catch (e: DivisionByZeroError) {",
    "        printf(\"Caught DivisionByZeroError: %s\\n\", e.message);",
    "    }",
    "",
    "    printf(\"\\nSafe Array Access:\\n\");",
    "    local numbers: int[5] = [10, 20, 30, 40, 50];",
    "    local size: int = 5;",
    "",
    "    try {",
    "        local val: int = safeArrayAccess(&numbers[0], size, 2);",
    "        printf(\"numbers[2] = %d\\n\", val);",
    "        ",
    "        # This will throw",
    "        printf(\"Attempting access at index 10...\\n\");",
    "        safeArrayAccess(&numbers[0], size, 10);",
    "    } catch (e: OutOfBoundsError) {",
    "        printf(\"Caught OutOfBoundsError: Index %d out of bounds (size %d)\\n\", e.index, e.size);",
    "    } catch (e: DivisionByZeroError) {",
    "        printf(\"Caught unexpected DivisionByZeroError\\n\");",
    "    }",
    "",
    "    # Example with catchOther",
    "    printf(\"\\nCatch All Example:\\n\");",
    "    try {",
    "        throw 42; # Throwing a primitive int",
    "    } catch (e: int) {",
    "        printf(\"Caught integer exception: %d\\n\", e);",
    "    } catchOther {",
    "        printf(\"Caught something else\\n\");",
    "    }",
    "",
    "    return 0;",
    "}"
  ]
}
