{
  "order": 40,
  "title": "Bit Manipulation Advanced",
  "snippet": "Advanced bitwise operations and bit fields",
  "description": "Advanced bit manipulation enables efficient algorithms and compact data representation. Techniques include: bit masks for flags/permissions, bit fields for packing data, bit counting (population count), finding set/clear bits, swapping values without temp variables, power-of-two detection, parity checking. Applications: graphics (color channels), compression, cryptography, embedded systems, performance optimization. Common patterns: isolate bit i with (x & (1 << i)), set bit i with (x | (1 << i)), clear bit i with (x & ~(1 << i)), toggle bit i with (x ^ (1 << i)). This example demonstrates sophisticated bit manipulation algorithms and optimization techniques.",
  "code": [
    "extern printf(fmt: string, ...);",
    "",
    "# Utility functions for bit manipulation",
    "frame getBit(num: int, pos: int) ret int {",
    "    return (num >> pos) & 1;",
    "}",
    "",
    "frame setBit(num: int, pos: int) ret int {",
    "    return num | (1 << pos);",
    "}",
    "",
    "frame clearBit(num: int, pos: int) ret int {",
    "    return num & ~(1 << pos);",
    "}",
    "",
    "frame toggleBit(num: int, pos: int) ret int {",
    "    return num ^ (1 << pos);",
    "}",
    "",
    "frame countSetBits(num: int) ret int {",
    "    local count: int = 0;",
    "    local temp: int = num;",
    "    loop (temp > 0) {",
    "        if ((temp & 1) == 1) {",
    "            count = count + 1;",
    "        }",
    "        temp = temp >> 1;",
    "    }",
    "    return count;",
    "}",
    "",
    "frame isPowerOfTwo(num: int) ret bool {",
    "    if (num <= 0) {",
    "        return false;",
    "    }",
    "    local result: int = num & (num - 1);",
    "    if (result == 0) {",
    "        return true;",
    "    } else {",
    "        return false;",
    "    }",
    "}",
    "",
    "frame printBinary(num: int) ret void {",
    "    printf(\"Binary: \");",
    "    local i: int = 31;",
    "    loop (i >= 0) {",
    "        local bit: int = (num >> i) & 1;",
    "        printf(\"%d\", bit);",
    "        if ((i > 0) && ((i % 8) == 0)) {",
    "            printf(\" \");",
    "        }",
    "        i = i - 1;",
    "    }",
    "    printf(\"\\n\");",
    "}",
    "",
    "frame main() ret int {",
    "    printf(\"=== Advanced Bit Manipulation ===\\n\\n\");",
    "    ",
    "    local num: int = 42;",
    "    printf(\"Number: %d\\n\", num);",
    "    printBinary(num);",
    "    ",
    "    # Get individual bits",
    "    printf(\"\\nBit Extraction:\\n\");",
    "    local bit0: int = getBit(num, 0);",
    "    local bit5: int = getBit(num, 5);",
    "    printf(\"Bit at position 0: %d\\n\", bit0);",
    "    printf(\"Bit at position 5: %d\\n\", bit5);",
    "    ",
    "    # Set bits",
    "    printf(\"\\nSet Bit (position 0):\\n\");",
    "    local set_result: int = setBit(num, 0);",
    "    printf(\"Result: %d\\n\", set_result);",
    "    printBinary(set_result);",
    "    ",
    "    # Clear bits",
    "    printf(\"\\nClear Bit (position 1):\\n\");",
    "    local clear_result: int = clearBit(num, 1);",
    "    printf(\"Result: %d\\n\", clear_result);",
    "    printBinary(clear_result);",
    "    ",
    "    # Toggle bits",
    "    printf(\"\\nToggle Bit (position 3):\\n\");",
    "    local toggle_result: int = toggleBit(num, 3);",
    "    printf(\"Result: %d\\n\", toggle_result);",
    "    printBinary(toggle_result);",
    "    ",
    "    # Count set bits",
    "    printf(\"\\nBit Operations:\\n\");",
    "    local bits_set: int = countSetBits(num);",
    "    printf(\"Number of set bits in %d: %d\\n\", num, bits_set);",
    "    ",
    "    # Check powers of two",
    "    printf(\"\\nPower of Two Check:\\n\");",
    "    local pow_64: int = 64;",
    "    local pow_100: int = 100;",
    "    if (isPowerOfTwo(pow_64)) {",
    "        printf(\"%d is a power of 2\\n\", pow_64);",
    "    }",
    "    if (isPowerOfTwo(pow_100)) {",
    "        printf(\"%d is a power of 2\\n\", pow_100);",
    "    } else {",
    "        printf(\"%d is NOT a power of 2\\n\", pow_100);",
    "    }",
    "    ",
    "    # Bitwise operations",
    "    printf(\"\\nBitwise Operations:\\n\");",
    "    local a: int = 12;  # 1100 in binary",
    "    local b: int = 10;  # 1010 in binary",
    "    printf(\"a = %d\\n\", a);",
    "    printBinary(a);",
    "    printf(\"b = %d\\n\", b);",
    "    printBinary(b);",
    "    printf(\"a & b (AND) = %d\\n\", a & b);",
    "    printf(\"a | b (OR) = %d\\n\", a | b);",
    "    printf(\"a ^ b (XOR) = %d\\n\", a ^ b);",
    "    printf(\"~a (NOT) = %d\\n\", ~a);",
    "    ",
    "    return 0;",
    "}"
  ]
}
