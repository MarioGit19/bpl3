#compdef bpl
# Zsh completion script for bpl CLI
# Installation:
#   1. Copy this file to a directory in your $fpath (e.g., /usr/local/share/zsh/site-functions/_bpl)
#   2. Or add the completions directory to your fpath in ~/.zshrc:
#      fpath=(~/.local/share/zsh/completions $fpath)
#   3. Reload completions: rm -f ~/.zcompdump; compinit

_bpl() {
    local curcontext="$curcontext" state line
    typeset -A opt_args

    local -a commands
    commands=(
        'format:Format BPL source files'
        'init:Initialize a new BPL package'
        'pack:Package a BPL project'
        'install:Install a BPL package'
        'list:List installed BPL packages'
        'uninstall:Uninstall a BPL package'
        'completion:Generate shell completion scripts'
        'help:Display help information'
    )

    local -a global_options
    global_options=(
        '-e[Evaluate BPL code passed as string]:code'
        '--eval[Evaluate BPL code passed as string]:code'
        '--stdin[Read BPL code from stdin]'
        '-o[Output file path]:file:_files'
        '--output[Output file path]:file:_files'
        '--emit[Emit type]:type:(llvm ast tokens formatted)'
        '--target[Target triple for clang]:triple:(x86_64-pc-linux-gnu aarch64-unknown-linux-gnu arm64-apple-darwin x86_64-apple-darwin x86_64-pc-windows-gnu)'
        '--sysroot[Sysroot path for cross-compilation]:path:_directories'
        '--cpu[Target CPU for clang]:cpu'
        '--march[Target architecture for clang]:arch'
        '--clang-flag[Additional flags for clang]:flag'
        '-l[Libraries to link with]:library'
        '--lib[Libraries to link with]:library'
        '-L[Library search paths]:path:_directories'
        '--lib-path[Library search paths]:path:_directories'
        '--object[Object files to link]:file:_files -g "*.{o,ll,bc}"'
        '--run[Run the generated code]'
        '-v[Enable verbose output]'
        '--verbose[Enable verbose output]'
        '--cache[Enable incremental compilation with module caching]'
        '--write[Write formatted output back to file]'
        '-h[Display help information]'
        '--help[Display help information]'
        '-V[Display version information]'
        '--version[Display version information]'
    )

    _arguments -C \
        '1: :->command' \
        '*::arg:->args' \
        $global_options

    case $state in
        command)
            _alternative \
                'commands:command:_describe "command" commands' \
                'files:BPL file:_files -g "*.bpl"'
            ;;
        args)
            case $words[1] in
                format)
                    _arguments \
                        '-w[Write formatted output back to file]' \
                        '--write[Write formatted output back to file]' \
                        '-v[Enable verbose output]' \
                        '--verbose[Enable verbose output]' \
                        '*:file:_files -g "*.bpl"'
                    ;;
                init)
                    _arguments \
                        '-v[Enable verbose output]' \
                        '--verbose[Enable verbose output]'
                    ;;
                pack)
                    _arguments \
                        '-v[Enable verbose output]' \
                        '--verbose[Enable verbose output]'
                    ;;
                install)
                    _arguments \
                        '-v[Enable verbose output]' \
                        '--verbose[Enable verbose output]' \
                        '1:package:_files'
                    ;;
                list)
                    _arguments \
                        '-v[Enable verbose output]' \
                        '--verbose[Enable verbose output]'
                    ;;
                uninstall)
                    _arguments \
                        '-v[Enable verbose output]' \
                        '--verbose[Enable verbose output]' \
                        '1:package:'
                    ;;
                completion)
                    _arguments \
                        '1:shell:(bash zsh)'
                    ;;
                help)
                    _describe 'command' commands
                    ;;
                *)
                    # For file compilation
                    _files -g "*.bpl"
                    ;;
            esac
            ;;
    esac
}

_bpl "$@"
